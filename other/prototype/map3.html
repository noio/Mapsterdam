<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<title>Full screen Map View</title>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script src="json_data/maps/buurten2010.js" type="text/javascript" charset="utf-8"></script>
<script src="json_data/maps/stadsdelen2010.js" type="text/javascript" charset="utf-8"></script>
<script src="json_data/2010_stadsdelen_geboorte_naar_herkomst.js" type="text/javascript" charset="utf-8"></script>
<script src="json_data/buurten_geboorte_naar_herkomst.js" type="text/javascript" charset="utf-8"></script>
<script src="geom.js" type="text/javascript" charset="utf-8"></script>
<script src="mootools-core-1.3.1.js" type="text/javascript" charset="utf-8"></script>
<script src="mootools-more-1.3.1.1.js" type="text/javascript" charset="utf-8"></script>

<!-- Make the document body take up the full screen -->
<style type="text/css">
  v\:* {behavior:url(#default#VML);}
  html, body {width: 100%; height: 100%}
  body {margin: 0}
</style>

<script type="text/javascript">
  // google.load("feeds", "1");
  // google.load("mootools","1.3.1")
  google.load("maps","3",{'other_params': "sensor=false"});
  google.setOnLoadCallback(initialize);
  
  var streetViewMarkers = [];
  var panorama;
  
  function initialize() {
    //var map;
    var deDam = new google.maps.LatLng(52.372730285566895, 4.893229007720947);
    var warmoes = new google.maps.LatLng(52.355, 4.90);
    var nietDeDam = new google.maps.LatLng(52.350, 4.95);
    var latLngOffset = 0.01;
    
    // Stylize the map: turn everything off and add only specific layers
    var stylishStyles = [
      {
        featureType: "all",
        elementType: "all",
        stylers: [
          { visibility: "off" } 
        ]
      },{
        featureType: "road.arterial",
        elementType: "geometry",
        stylers: [
          { visibility: "on" },
          { saturation: -100 },
          { lightness: -70 }
        ]
      },{
        featureType: "road.highway",
        elementType: "geometry",
        stylers: [
          { visibility: "on" },
          { saturation: -100 },
          { lightness: -70 }
        ]
      },{
        featureType: "water",
        elementType: "geometry",
        stylers: [
          { visibility: "on" },
          { saturation: -100 },
          { lightness: 40 }
        ]
      },{
        featureType: "administrative",
        elementType: "labels",
        stylers: [
          { visibility: "on" },
          { saturation: -100 },
          { lightness: -10 },
          { gamma: 0.0 }
        ]
      }
    ];
    
    // Set up the map
    var mapOptions = {
      center: deDam,
      zoom: 13,
      disableDefaultUI: true,
      streetViewControl: true,
      minZoom: 12
    };
    window.map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);


    var stylishMapType = new google.maps.StyledMapType(
        stylishStyles, {name: "Stylish Map"});
        window.map.mapTypes.set('stylish', stylishMapType);
        window.map.setMapTypeId('stylish');
    
	
	for (var stadsdeel_code in bc2010){
		var polygons = bc2010[stadsdeel_code]['borders'];
		
		var nationaliteiten = [['Turken', 'Turkey.png'], ['Surinamers', 'Suriname.png'], ['Marokkanen', 'Morocco.png']]
		
		for(var i = 0; i < nationaliteiten.length; i++){
			var n = buurten_geboorte_naar_herkomst[stadsdeel_code][nationaliteiten[i][0]];
			var randomPoints = randomPointsInPolygons(polygons, Math.round(n/100));
			for (var j = 0; j < randomPoints.length; j ++){
				var markerImage = new google.maps.MarkerImage("images/flags/"+nationaliteiten[i][1]);
					markerImage.size = new google.maps.Size(16,16);        
					markerImage.scaledSize = new google.maps.Size(16,16);
				var marker = new google.maps.Marker({
				  'position': new google.maps.LatLng(randomPoints[j][1],randomPoints[j][0]),
				  'title': 't',
				  'map': window.map,
				  'icon':markerImage
				});
				}
			}
	}
	
	/* for (var code in stadsdelen_geboorte_naar_herkomst){
	    var stadsdeel = sd2010[code]['borders'][0];
	    var n = stadsdelen_geboorte_naar_herkomst[code]["Turken"];
	    var randomPoints = randomPointsInPolygon(stadsdeel, n);
	    for (var i = 0; i < randomPoints.length; i ++){
	        var markerImage =
                new google.maps.MarkerImage("images/flags/Turkey.png");
                markerImage.size = new google.maps.Size(48,48);        
                markerImage.scaledSize = new google.maps.Size(48,48);
            var marker = new google.maps.Marker({
              'position': new google.maps.LatLng(randomPoints[i][1],randomPoints[i][0]),
              'title': 't',
              'map': window.map,
              'icon':markerImage
            });
	    }
	} */
	

	
	
	
    // We get the map's default panorama and set up some defaults.
    // Note that we don't yet set it visible.
    
    var rq = new Request.JSONP({
      'url':'http://pipes.yahoo.com/pipes/pipe.run?_id=8b293e09624748091af9b88d815ce0a5&_render=json',
      'callbackKey':'_callback',
      'onComplete':function(o){
        for (var i = 0; i < o.value.items.length; i++){
          var item = o.value.items[i];
          var loc = item['y:location'];
          if (!(loc==undefined)){
            var p = new google.maps.LatLng(parseFloat(loc['lat']),parseFloat(loc['lon']));
            makeEventMarker(p, item.title);
          }
        }
      }
    }).send()
    
    panorama = window.map.getStreetView();
    panorama.setPosition(deDam);
    panorama.setPov({
      heading: 265,
      zoom:1,
      pitch:0}
    );
    panorama.setVisible(false);
    
    // Remove Markers that are set for Street View
    google.maps.event.addListener(panorama,"visible_changed",function()  {
      var toggle = panorama.getVisible();
      if (toggle == false) { 
        clearStreetViewMarkers();
      }
    });   
  }
  
  function makeEventMarker(location, title) {
    var content = new Element('div');
    var h = new Element('h4',{'html':title});
    var a = new Element('a', {
      'html': 'Go to Street view',
      'href': '#',
      'events': {
        'click':function(event) {
          event.preventDefault();
          goToStreetView(location);
        }
      }
    });
    content.grab(h).grab(a)
    
    var infowindow = new google.maps.InfoWindow({'content': content});
    
    var markerImage =
        new google.maps.MarkerImage(
            "https://chart.googleapis.com/chart?chst=d_simple_text_icon_left&chld=+|14|000|caution|24|FFAA00|FFF");
        markerImage.size = new google.maps.Size(30,24);        
        markerImage.scaledSize = new google.maps.Size(30,24);
    
    var marker = new google.maps.Marker({
      'position': location,
      'title': title,
      'map': window.map,
      'icon':markerImage
    });
    
    google.maps.event.addListener(marker, 'click', function() {
      infowindow.open(window.map,marker);
    });
  }
  
  function goToStreetView(loc) {
    var latLngOffset = 0.001;
    var markerImageRed =
        new google.maps.MarkerImage(
            'http://chart.googleapis.com/chart?chst=d_simple_text_icon_left&chld=+|3|000|glyphish_skull-n-crossbones|24|FF0000|FFF');
    markerImageRed.size = new google.maps.Size(28*2,24*2);        
    markerImageRed.scaledSize = new google.maps.Size(28*2,24*2);
    
    var markerImageGreen =
        new google.maps.MarkerImage(
            'http://chart.googleapis.com/chart?chst=d_simple_text_icon_left&chld=+|3|000|glyphish_skull-n-crossbones|24|00FF00|FFF');
    markerImageGreen.size = new google.maps.Size(28*2,24*2);        
    markerImageGreen.scaledSize = new google.maps.Size(28*2,24*2);
    
    for (var i = 0; i < 100; i ++){
        p = new google.maps.LatLng(
            loc.lat()+(latLngOffset/2) + Math.random()*2*latLngOffset - latLngOffset,
            loc.lng() + Math.random()*2*latLngOffset - latLngOffset
        )
        var marker = new google.maps.Marker({
            position: p,
            map: window.map,
            icon: markerImageRed,
            title: 'Red Crime'
        });
        streetViewMarkers.push(marker);
    }
    for (var i = 0; i < 100; i ++){
        p = new google.maps.LatLng(
            loc.lat()-(latLngOffset/2) + Math.random()*2*latLngOffset - latLngOffset,
            loc.lng() + Math.random()*2*latLngOffset - latLngOffset
        )
        var marker = new google.maps.Marker({
            position: p,
            map: window.map,
            icon: markerImageGreen,
            title: 'Green Crime'
        });
        streetViewMarkers.push(marker);
    }
    panorama.setPosition(loc);
    panorama.setVisible(true);
  }
  
  function clearStreetViewMarkers() {
    if (streetViewMarkers) {
      for (var i=0;i<streetViewMarkers.length;i++) {
        streetViewMarkers[i].setMap(null);
      }
      streetViewMarkers.length = 0;
    }
  }
</script>
</head>
<body>
  <div id="map-canvas" style="width: 100%; height: 100%"></div>
</body>
</html>
